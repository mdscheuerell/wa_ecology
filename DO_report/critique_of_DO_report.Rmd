---
title: "Critique of model evaluation by WA Dept of Ecology"
author: "Mark Scheuerell"
date: "10/31/2019"
output:
  pdf_document:
    highlight: haddock
fontsize: 11pt
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, dev = "pdf")
```


# Error in assumptions

In the section titled "Uncertainty in Dissolved Oxygen Depletion Estimates" (p59), there is an error in the assumed relationship between the standard deviation of the predictions and root mean squared error (RMSE) of the predictions. Specifically, the document incorrectly suggests that

$$
\text{Var}(\hat{y}) = \text{RMSE}(\hat{y})^2 ~ \Rightarrow ~ \text{SD}(\hat{y}) = \text{RMSE}(\hat{y}).
$$

Specifically, the standard deviation of ${\hat{y}}$ is based upon differences between the predicted data points $\hat{y}_i$ and their mean $m_{\hat{y}}$

$$
\text{SD}(\hat{y}) = \sqrt{\frac{(\hat{y}_i - m_{\hat{y}})^2}{N}},
$$

whereas the RMSE of $\hat{y}$ is based upon differences between the predicted data points and their corresponding observed values $x_i$

$$
\text{RMSE}(\hat{y}) = \sqrt{\frac{(\hat{y}_i - y_i)^2}{N}}.
$$

Thus,

$$
\begin{aligned}
\sqrt{\frac{(\hat{y}_i - m_{\hat{y}})^2}{N}} &\neq \sqrt{\frac{(\hat{y}_i - y_i)^2}{N}} \\
\text{SD}(\hat{y}) &\neq \text{RMSE}(\hat{y}).
\end{aligned}
$$

# An example

Here is a simple example based upon a linear regression model that shows how $\text{SD}(\hat{y})$ and $\text{RMSE}(\hat{y})$ are different. Consider a case where we had reason to believe that a variable $y$ was a function of another variable $x$. In effort to undercover the nature of their relationship, we collected a number of samples of both $y$ and $x$.

Here we assume that each of the observed values $y_i$ is a linear combination of an intercept $\alpha$, the effect $\beta$ of a covariate $x_i$, and some random observation error $\epsilon_i$, such that

$$
y_i = \alpha + \beta x_i + \epsilon_i,
$$

and $\epsilon_i \sim \text{N}(0, \sigma)$. the predictions are given by

$$
\hat{y}_i = \hat{\alpha} + \hat{\beta} x_i.
$$

\vspace{0.2in}

```{r regr_ex, echo = FALSE}
## set random seed for reprodicibility
set.seed(123)

## function to calculate RMSE
rmse <- function(pre, obs) {
  rmse <- sqrt(sum((pre - obs)^2)/length(pre))
  return(rmse)
}

## sample size
nn <- 20
## some values for the predictor x
xx <- sort(runif(nn, 0, 20))
## intercept
alpha <- 1
## slope
beta <- 0.5
## random errors (mean = 0, SD = 1)
epsilon <- rnorm(nn)
## observed data
yy <- alpha + beta*xx + epsilon

## fit a regression model
mm <- lm(yy ~ xx)
## get predicted values
yhat <- predict(mm)
```


```{r plot_regr_ex, echo = FALSE, fig.width = 8, fig.height = 5, fig.align="center"}
par(mfrow = c(1,2), mai = c(1.5,1,0.5,0.25), cex = 0.7)
## plot yhat and mean(yhat)
plot(xx, yy, pch = 16, las = 1, type = "n",
     xlab = expression(italic(x)),
     ylab = expression(italic(y)~~or~~m[hat(italic(y))]))
mtext("SD", side = 3, line = 1)
segments(x0 = xx, y0 = yhat, y1 = mean(yhat), col = "gray")
points(xx, yhat, pch = 21, bg = "white")
points(xx, rep(mean(yy), nn), pch = 19)
## plot observed and yhat
plot(xx, yy, pch = 16, las = 1, type = "n",
     xlab = expression(italic(x)),
     ylab = expression(italic(y)~~or~~hat(italic(y))))
mtext("RMSE", side = 3, line = 1)
segments(x0 = xx, y0 = yhat, y1 = yy, col = "gray")
points(xx, yy, pch = 19)
points(xx, yhat, pch = 21, bg = "white")

## calculate RMSE
round(rmse(yhat, yy), 3)
## calculate SD
round(sd(yhat), 3)

sqrt(var(xx) * coef(mm)[2]^2)
```

